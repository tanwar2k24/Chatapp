<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.16">
<meta name="author" content="Support Team">
<title>Clustering for Load Balancing and Fail Over</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote::before{display:none}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{word-spacing:0;line-height:1.6}
.quoteblock.abstract blockquote::before,.quoteblock.abstract p::before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0; text-align:center}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1><span class="image left"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiCiAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgeG1sbnM6aW5rc2NhcGU9Imh0dHA6Ly93d3cuaW5rc2NhcGUub3JnL25hbWVzcGFjZXMvaW5rc2NhcGUiCiAgIHdpZHRoPSIxMTIyLjUxOTciCiAgIGhlaWdodD0iMTgxIgogICB2aWV3Qm94PSIwIDAgMTU3MS41Mzg3IDI1My40MDE4MSIKICAgdmVyc2lvbj0iMS4yIgogICBpZD0ic3ZnNDY2OSIKICAgc29kaXBvZGk6ZG9jbmFtZT0ibG9nby5zdmciCiAgIGlua3NjYXBlOnZlcnNpb249IjAuOTIuMSByMTUzNzEiPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTQ2NzMiPgogICAgPHJkZjpSREY+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgIHJkZjphYm91dD0iIj4KICAgICAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgICAgICA8ZGM6dHlwZQogICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiIC8+CiAgICAgICAgPGRjOnRpdGxlPjwvZGM6dGl0bGU+CiAgICAgIDwvY2M6V29yaz4KICAgIDwvcmRmOlJERj4KICA8L21ldGFkYXRhPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiM2NjY2NjYiCiAgICAgYm9yZGVyb3BhY2l0eT0iMSIKICAgICBvYmplY3R0b2xlcmFuY2U9IjEwIgogICAgIGdyaWR0b2xlcmFuY2U9IjEwIgogICAgIGd1aWRldG9sZXJhbmNlPSIxMCIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIKICAgICBpbmtzY2FwZTpwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTkwNSIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI1MjMiCiAgICAgaWQ9Im5hbWVkdmlldzQ2NzEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjEiCiAgICAgaW5rc2NhcGU6Y3g9IjQ2MC43NjI1MyIKICAgICBpbmtzY2FwZTpjeT0iMTIyLjYyNDQxIgogICAgIGlua3NjYXBlOndpbmRvdy14PSI1IgogICAgIGlua3NjYXBlOndpbmRvdy15PSIzOTYiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMCIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJzdmc0NjY5IgogICAgIHVuaXRzPSJweCIKICAgICBzY2FsZS14PSIxLjQwMDAxIiAvPgogIDxkZWZzCiAgICAgaWQ9ImRlZnM0NjM4Ij4KICAgIDxnCiAgICAgICBpZD0iZzQ2MzYiPgogICAgICA8c3ltYm9sCiAgICAgICAgIG92ZXJmbG93PSJ2aXNpYmxlIgogICAgICAgICBpZD0iZ2x5cGgwLTAiCiAgICAgICAgIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlIj4KICAgICAgICA8cGF0aAogICAgICAgICAgIHN0eWxlPSJzdHJva2U6bm9uZSIKICAgICAgICAgICBkPSJtIDEzLjYyNSwwIHYgLTY4LjEyNSBoIDU0LjUgViAwIFogbSAxLjcwMzEyNSwtMS43MDMxMjUgaCA1MS4wOTM3NSB2IC02NC43MTg3NSBoIC01MS4wOTM3NSB6IG0gMCwwIgogICAgICAgICAgIGlkPSJwYXRoNDYwOSIKICAgICAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgICA8L3N5bWJvbD4KICAgICAgPHN5bWJvbAogICAgICAgICBvdmVyZmxvdz0idmlzaWJsZSIKICAgICAgICAgaWQ9ImdseXBoMC0xIgogICAgICAgICBzdHlsZT0ib3ZlcmZsb3c6dmlzaWJsZSI+CiAgICAgICAgPHBhdGgKICAgICAgICAgICBzdHlsZT0ic3Ryb2tlOm5vbmUiCiAgICAgICAgICAgZD0ibSAxNi41LC03OC4yOTY4NzUgaCAxNC41NzgxMjUgbCAxOC4wOTM3NSw1NC42MDkzNzUgMTguMzc1LC01NC42MDkzNzUgSCA4MS45MDYyNSBMIDk1LjEwOTM3NSwwIGggLTE0LjM3NSBMIDcyLjMyODEyNSwtNDkuNDM3NSA1NS42NzE4NzUsMCBIIDQyLjUzMTI1IEwgMjYuMDc4MTI1LC00OS40Mzc1IDE3LjUxNTYyNSwwIEggMi45ODQzNzUgWiBtIDAsMCIKICAgICAgICAgICBpZD0icGF0aDQ2MTIiCiAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgLz4KICAgICAgPC9zeW1ib2w+CiAgICAgIDxzeW1ib2wKICAgICAgICAgb3ZlcmZsb3c9InZpc2libGUiCiAgICAgICAgIGlkPSJnbHlwaDAtMiIKICAgICAgICAgc3R5bGU9Im92ZXJmbG93OnZpc2libGUiPgogICAgICAgIDxwYXRoCiAgICAgICAgICAgc3R5bGU9InN0cm9rZTpub25lIgogICAgICAgICAgIGQ9Im0gNzYuMTA5Mzc1LC0xMS40Mzc1IDEzLjYyNSwxNy42MDkzNzUgSCA3Mi4wNjI1IEwgNjUuMTQwNjI1LC0yLjcxODc1IGMgLTUuNzEwOTM3LDMuMTI1IC0xMi4wNzgxMjUsNC42ODc1IC0xOS4xMDkzNzUsNC42ODc1IC0xMS43NDIxODcsMCAtMjEuNDk2MDk0LC00LjA1MDc4MSAtMjkuMjY1NjI1LC0xMi4xNTYyNSAtNy43NzM0MzcsLTguMTEzMjgxIC0xMS42NTYyNSwtMTcuNzczNDM4IC0xMS42NTYyNSwtMjguOTg0Mzc1IDAsLTcuNDg4MjgxIDEuODA0Njg4LC0xNC4zNjMyODEgNS40MjE4NzUsLTIwLjYyNSAzLjYyNSwtNi4yNTc4MTMgOC42MDE1NjMsLTExLjIzNDM3NSAxNC45Mzc1LC0xNC45MjE4NzUgNi4zMzIwMzEsLTMuNjk1MzEzIDEzLjEzMjgxMywtNS41NDY4NzUgMjAuNDA2MjUsLTUuNTQ2ODc1IDExLjEwMTU2MywwIDIwLjY0MDYyNSw0LjAxMTcxOSAyOC42MDkzNzUsMTIuMDMxMjUgNy45Njg3NSw4LjAyMzQzNyAxMS45NTMxMjUsMTcuNzk2ODc1IDExLjk1MzEyNSwyOS4zMjgxMjUgMCwxMC42MDU0NjkgLTMuNDQ1MzEyLDE5Ljc2MTcxOSAtMTAuMzI4MTI1LDI3LjQ2ODc1IHogbSAtOS4zMTI1LC0xMi4wMzEyNSBjIDMuMTU2MjUsLTQuNjg3NSA0LjczNDM3NSwtOS44NjcxODggNC43MzQzNzUsLTE1LjU0Njg3NSAwLC03LjQxNDA2MyAtMi41MDc4MTIsLTEzLjcxMDkzOCAtNy41MTU2MjUsLTE4Ljg5MDYyNSAtNSwtNS4xNzU3ODEgLTExLjA0Njg3NSwtNy43NjU2MjUgLTE4LjE0MDYyNSwtNy43NjU2MjUgLTcuMzA0Njg3LDAgLTEzLjQyMTg3NSwyLjUyMzQzNyAtMTguMzU5Mzc1LDcuNTYyNSAtNC45Mjk2ODcsNS4wMzEyNSAtNy4zOTA2MjUsMTEuNDMzNTk0IC03LjM5MDYyNSwxOS4yMDMxMjUgMCw4LjY1NjI1IDMuMTAxNTYzLDE1LjUwNzgxMiA5LjMxMjUsMjAuNTQ2ODc1IDQuODUxNTYzLDMuOTM3NSAxMC4zNjcxODgsNS45MDYyNSAxNi41NDY4NzUsNS45MDYyNSAzLjU1MDc4MSwwIDYuODgyODEzLC0wLjY5MTQwNiAxMCwtMi4wNzgxMjUgTCA0MiwtMzIuNTc4MTI1IGggMTcuNzY1NjI1IHogbSAwLDAiCiAgICAgICAgICAgaWQ9InBhdGg0NjE1IgogICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICAgIDwvc3ltYm9sPgogICAgICA8c3ltYm9sCiAgICAgICAgIG92ZXJmbG93PSJ2aXNpYmxlIgogICAgICAgICBpZD0iZ2x5cGgwLTMiCiAgICAgICAgIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlIj4KICAgICAgICA8cGF0aAogICAgICAgICAgIHN0eWxlPSJzdHJva2U6bm9uZSIKICAgICAgICAgICBkPSJNIDEuMjE4NzUsLTc4LjI5Njg3NSBIIDQ0LjUgViAtNjMuNTkzNzUgSCAzMC4yMzQzNzUgViAwIGggLTE1LjEyNSBWIC02My41OTM3NSBIIDEuMjE4NzUgWiBtIDAsMCIKICAgICAgICAgICBpZD0icGF0aDQ2MTgiCiAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgLz4KICAgICAgPC9zeW1ib2w+CiAgICAgIDxzeW1ib2wKICAgICAgICAgb3ZlcmZsb3c9InZpc2libGUiCiAgICAgICAgIGlkPSJnbHlwaDEtMCIKICAgICAgICAgc3R5bGU9Im92ZXJmbG93OnZpc2libGUiPgogICAgICAgIDxwYXRoCiAgICAgICAgICAgc3R5bGU9InN0cm9rZTpub25lIgogICAgICAgICAgIGQ9Im0gMTMuNjI1LDAgdiAtNjguMTI1IGggNTQuNSBWIDAgWiBtIDEuNzAzMTI1LC0xLjcwMzEyNSBoIDUxLjA5Mzc1IHYgLTY0LjcxODc1IGggLTUxLjA5Mzc1IHogbSAwLDAiCiAgICAgICAgICAgaWQ9InBhdGg0NjIxIgogICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICAgIDwvc3ltYm9sPgogICAgICA8c3ltYm9sCiAgICAgICAgIG92ZXJmbG93PSJ2aXNpYmxlIgogICAgICAgICBpZD0iZ2x5cGgxLTEiCiAgICAgICAgIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlIj4KICAgICAgICA8cGF0aAogICAgICAgICAgIHN0eWxlPSJzdHJva2U6bm9uZSIKICAgICAgICAgICBkPSJtIDE2LjUsLTExLjcwMzEyNSBjIDEuODEyNSwwIDMuMzUxNTYzLDAuNjQwNjI1IDQuNjI1LDEuOTIxODc1IDEuMjgxMjUsMS4yNzM0MzcgMS45MjE4NzUsMi44MjgxMjUgMS45MjE4NzUsNC42NzE4NzUgMCwxLjgxMjUgLTAuNjQwNjI1LDMuMzY3MTg3IC0xLjkyMTg3NSw0LjY1NjI1IC0xLjI3MzQzNywxLjI4OTA2MyAtMi44MTI1LDEuOTM3NSAtNC42MjUsMS45Mzc1IC0xLjgxMjUsMCAtMy4zNTkzNzUsLTAuNjQ4NDM3IC00LjY0MDYyNSwtMS45Mzc1IC0xLjI3MzQzNywtMS4yODkwNjMgLTEuOTA2MjUsLTIuODQzNzUgLTEuOTA2MjUsLTQuNjU2MjUgMCwtMS44NDM3NSAwLjYzMjgxMywtMy4zOTg0MzggMS45MDYyNSwtNC42NzE4NzUgMS4yODEyNSwtMS4yODEyNSAyLjgyODEyNSwtMS45MjE4NzUgNC42NDA2MjUsLTEuOTIxODc1IHogbSAwLDAiCiAgICAgICAgICAgaWQ9InBhdGg0NjI0IgogICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICAgIDwvc3ltYm9sPgogICAgICA8c3ltYm9sCiAgICAgICAgIG92ZXJmbG93PSJ2aXNpYmxlIgogICAgICAgICBpZD0iZ2x5cGgxLTIiCiAgICAgICAgIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlIj4KICAgICAgICA8cGF0aAogICAgICAgICAgIHN0eWxlPSJzdHJva2U6bm9uZSIKICAgICAgICAgICBkPSJtIDgyLjQzNzUsLTYzLjc2NTYyNSAtNi4xNzE4NzUsNC43MzQzNzUgQyA3Mi44NTkzNzUsLTYzLjQ1NzAzMSA2OC43Njk1MzEsLTY2LjgxNjQwNiA2NCwtNjkuMTA5Mzc1IGMgLTQuNzczNDM3LC0yLjI4OTA2MyAtMTAuMDE1NjI1LC0zLjQzNzUgLTE1LjczNDM3NSwtMy40Mzc1IC02LjI0MjE4NywwIC0xMi4wMjM0MzcsMS41IC0xNy4zNDM3NSw0LjUgLTUuMzI0MjE5LDMgLTkuNDQ5MjE5LDcuMDMxMjUgLTEyLjM3NSwxMi4wOTM3NSAtMi45Mjk2ODcsNS4wNTQ2ODcgLTQuMzkwNjI1LDEwLjczNDM3NSAtNC4zOTA2MjUsMTcuMDQ2ODc1IDAsOS41NDI5NjkgMy4yNjk1MzEsMTcuNTExNzE5IDkuODEyNSwyMy45MDYyNSA2LjU1MDc4MSw2LjM4NjcxOSAxNC44MTI1LDkuNTc4MTI1IDI0Ljc4MTI1LDkuNTc4MTI1IDEwLjk2ODc1LDAgMjAuMTQwNjI1LC00LjI5Njg3NSAyNy41MTU2MjUsLTEyLjg5MDYyNSBsIDYuMTcxODc1LDQuNjg3NSBjIC0zLjg5ODQzNyw0Ljk2ODc1IC04Ljc2NTYyNSw4LjgxMjUgLTE0LjYwOTM3NSwxMS41MzEyNSAtNS44MzU5MzcsMi43MDcwMzEgLTEyLjM1NTQ2OSw0LjA2MjUgLTE5LjU2MjUsNC4wNjI1IC0xMy42ODc1LDAgLTI0LjQ5MjE4NywtNC41NTQ2ODggLTMyLjQwNjI1LC0xMy42NzE4NzUgQyA5LjIyMjY1NiwtMTkuNDEwMTU2IDUuOTA2MjUsLTI4LjcwNzAzMSA1LjkwNjI1LC0zOS41OTM3NSBjIDAsLTExLjQ1NzAzMSA0LjAxNTYyNSwtMjEuMDk3NjU2IDEyLjA0Njg3NSwtMjguOTIxODc1IDguMDM5MDYzLC03LjgzMjAzMSAxOC4xMTMyODEsLTExLjc1IDMwLjIxODc1LC0xMS43NSA3LjMwMDc4MSwwIDEzLjg5NDUzMSwxLjQ0OTIxOSAxOS43ODEyNSw0LjM0Mzc1IDUuODk0NTMxLDIuODk4NDM3IDEwLjcyMjY1Niw2Ljk0OTIxOSAxNC40ODQzNzUsMTIuMTU2MjUgeiBtIDAsMCIKICAgICAgICAgICBpZD0icGF0aDQ2MjciCiAgICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgLz4KICAgICAgPC9zeW1ib2w+CiAgICAgIDxzeW1ib2wKICAgICAgICAgb3ZlcmZsb3c9InZpc2libGUiCiAgICAgICAgIGlkPSJnbHlwaDEtMyIKICAgICAgICAgc3R5bGU9Im92ZXJmbG93OnZpc2libGUiPgogICAgICAgIDxwYXRoCiAgICAgICAgICAgc3R5bGU9InN0cm9rZTpub25lIgogICAgICAgICAgIGQ9Im0gMzUuNzE4NzUsLTU5LjM5MDYyNSBjIDguOTA2MjUsMCAxNi4yODUxNTYsMy4yMzA0NjkgMjIuMTQwNjI1LDkuNjg3NSA1LjMyMDMxMyw1Ljg4NjcxOSA3Ljk4NDM3NSwxMi44NTU0NjkgNy45ODQzNzUsMjAuOTA2MjUgMCw4LjA5Mzc1IC0yLjgxMjUsMTUuMTY3OTY5IC04LjQzNzUsMjEuMjE4NzUgLTUuNjI1LDYuMDQyOTY5IC0xMi44NTU0NjksOS4wNjI1IC0yMS42ODc1LDkuMDYyNSAtOC44NzUsMCAtMTYuMTI1LC0zLjAxOTUzMSAtMjEuNzUsLTkuMDYyNSAtNS42MjUsLTYuMDUwNzgxIC04LjQzNzUsLTEzLjEyNSAtOC40Mzc1LC0yMS4yMTg3NSAwLC04LjAxOTUzMSAyLjY2MDE1NiwtMTQuOTcyNjU2IDcuOTg0Mzc1LC0yMC44NTkzNzUgNS44NTE1NjMsLTYuNDg4MjgxIDEzLjI1MzkwNiwtOS43MzQzNzUgMjIuMjAzMTI1LC05LjczNDM3NSB6IG0gMCw3LjI4MTI1IGMgLTYuMTc5Njg3LDAgLTExLjQ4NDM3NSwyLjI5Mjk2OSAtMTUuOTIxODc1LDYuODc1IC00LjQzNzUsNC41NzQyMTkgLTYuNjU2MjUsMTAuMTA1NDY5IC02LjY1NjI1LDE2LjU5Mzc1IDAsNC4xODc1IDEuMDA3ODEzLDguMDkzNzUgMy4wMzEyNSwxMS43MTg3NSAyLjAzMTI1LDMuNjE3MTg3IDQuNzY1NjI1LDYuNDA2MjUgOC4yMDMxMjUsOC4zNzUgMy40Mzc1LDEuOTY4NzUgNy4yMTg3NSwyLjk1MzEyNSAxMS4zNDM3NSwyLjk1MzEyNSA0LjExMzI4MSwwIDcuODkwNjI1LC0wLjk4NDM3NSAxMS4zMjgxMjUsLTIuOTUzMTI1IDMuNDQ1MzEzLC0xLjk2ODc1IDYuMTc5Njg4LC00Ljc1NzgxMyA4LjIwMzEyNSwtOC4zNzUgMi4wMTk1MzEsLTMuNjI1IDMuMDMxMjUsLTcuNTMxMjUgMy4wMzEyNSwtMTEuNzE4NzUgMCwtNi40ODgyODEgLTIuMjMwNDY5LC0xMi4wMTk1MzEgLTYuNjg3NSwtMTYuNTkzNzUgLTQuNDQ5MjE5LC00LjU4MjAzMSAtOS43NDIxODcsLTYuODc1IC0xNS44NzUsLTYuODc1IHogbSAwLDAiCiAgICAgICAgICAgaWQ9InBhdGg0NjMwIgogICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICAgIDwvc3ltYm9sPgogICAgICA8c3ltYm9sCiAgICAgICAgIG92ZXJmbG93PSJ2aXNpYmxlIgogICAgICAgICBpZD0iZ2x5cGgxLTQiCiAgICAgICAgIHN0eWxlPSJvdmVyZmxvdzp2aXNpYmxlIj4KICAgICAgICA8cGF0aAogICAgICAgICAgIHN0eWxlPSJzdHJva2U6bm9uZSIKICAgICAgICAgICBkPSJtIDcuMTg3NSwtODAuMjY1NjI1IGggNy40NTMxMjUgViAwIEggNy4xODc1IFogbSAwLDAiCiAgICAgICAgICAgaWQ9InBhdGg0NjMzIgogICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiIC8+CiAgICAgIDwvc3ltYm9sPgogICAgPC9nPgogIDwvZGVmcz4KICA8ZwogICAgIGlkPSJzdXJmYWNlMTg2MTYxIgogICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMDM0ODAyMywwLDAsMS4wMzQ4MDIzLC0yNjAuNTcxNTIsLTU5OC4zOTEwMSkiPgogICAgPGcKICAgICAgIHN0eWxlPSJmaWxsOiMyODVjNzM7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICBpZD0iZzQ2NDgiPgogICAgICA8dXNlCiAgICAgICAgIHhsaW5rOmhyZWY9IiNnbHlwaDAtMSIKICAgICAgICAgeD0iNDQwLjMzNzg5IgogICAgICAgICB5PSI2NzMuNDUzMTIiCiAgICAgICAgIGlkPSJ1c2U0NjQwIgogICAgICAgICB3aWR0aD0iMTAwJSIKICAgICAgICAgaGVpZ2h0PSIxMDAlIiAvPgogICAgICA8dXNlCiAgICAgICAgIHhsaW5rOmhyZWY9IiNnbHlwaDAtMiIKICAgICAgICAgeD0iNTM2LjAyMTY3IgogICAgICAgICB5PSI2NzMuNDUzMTIiCiAgICAgICAgIGlkPSJ1c2U0NjQyIgogICAgICAgICB3aWR0aD0iMTAwJSIKICAgICAgICAgaGVpZ2h0PSIxMDAlIiAvPgogICAgICA8dXNlCiAgICAgICAgIHhsaW5rOmhyZWY9IiNnbHlwaDAtMyIKICAgICAgICAgeD0iNjI1LjE0NDI5IgogICAgICAgICB5PSI2NzMuNDUzMTIiCiAgICAgICAgIGlkPSJ1c2U0NjQ0IgogICAgICAgICB3aWR0aD0iMTAwJSIKICAgICAgICAgaGVpZ2h0PSIxMDAlIiAvPgogICAgICA8dXNlCiAgICAgICAgIHhsaW5rOmhyZWY9IiNnbHlwaDAtMyIKICAgICAgICAgeD0iNjY4LjMzODY4IgogICAgICAgICB5PSI2NzMuNDUzMTIiCiAgICAgICAgIGlkPSJ1c2U0NjQ2IgogICAgICAgICB3aWR0aD0iMTAwJSIKICAgICAgICAgaGVpZ2h0PSIxMDAlIiAvPgogICAgPC9nPgogICAgPGcKICAgICAgIHN0eWxlPSJmaWxsOiMyODVjNzM7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICBpZD0iZzQ2NjAiPgogICAgICA8dXNlCiAgICAgICAgIHhsaW5rOmhyZWY9IiNnbHlwaDEtMSIKICAgICAgICAgeD0iNzExLjUzMzA4IgogICAgICAgICB5PSI2NzMuNDUzMTIiCiAgICAgICAgIGlkPSJ1c2U0NjUwIgogICAgICAgICB3aWR0aD0iMTAwJSIKICAgICAgICAgaGVpZ2h0PSIxMDAlIiAvPgogICAgICA8dXNlCiAgICAgICAgIHhsaW5rOmhyZWY9IiNnbHlwaDEtMiIKICAgICAgICAgeD0iNzM5LjA5MDAzIgogICAgICAgICB5PSI2NzMuNDUzMTIiCiAgICAgICAgIGlkPSJ1c2U0NjUyIgogICAgICAgICB3aWR0aD0iMTAwJSIKICAgICAgICAgaGVpZ2h0PSIxMDAlIiAvPgogICAgICA8dXNlCiAgICAgICAgIHhsaW5rOmhyZWY9IiNnbHlwaDEtMyIKICAgICAgICAgeD0iODI1LjI2MDEzIgogICAgICAgICB5PSI2NzMuNDUzMTIiCiAgICAgICAgIGlkPSJ1c2U0NjU0IgogICAgICAgICB3aWR0aD0iMTAwJSIKICAgICAgICAgaGVpZ2h0PSIxMDAlIiAvPgogICAgICA8dXNlCiAgICAgICAgIHhsaW5rOmhyZWY9IiNnbHlwaDEtMyIKICAgICAgICAgeD0iODk0LjE1MjQiCiAgICAgICAgIHk9IjY3My40NTMxMiIKICAgICAgICAgaWQ9InVzZTQ2NTYiCiAgICAgICAgIHdpZHRoPSIxMDAlIgogICAgICAgICBoZWlnaHQ9IjEwMCUiIC8+CiAgICAgIDx1c2UKICAgICAgICAgeGxpbms6aHJlZj0iI2dseXBoMS00IgogICAgICAgICB4PSI5NjMuMDQ0NzQiCiAgICAgICAgIHk9IjY3My40NTMxMiIKICAgICAgICAgaWQ9InVzZTQ2NTgiCiAgICAgICAgIHdpZHRoPSIxMDAlIgogICAgICAgICBoZWlnaHQ9IjEwMCUiIC8+CiAgICA8L2c+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6IzI4NWM3MztmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6bm9uemVybztzdHJva2U6bm9uZSIKICAgICAgIGQ9Im0gMjg0LjQ4NDM3LDY5NC45NDkyMiBjIDAsMCAtMi44ODI4MSwtMjUuMDc0MjIgLTIuMTgzNTksLTI0LjM1OTM4IDI2Ljc0NjA5LDM1LjIyNjU3IDYyLjgzOTg0LDI0LjcxNDg1IDYyLjgzOTg0LDI0LjcxNDg1IGwgLTAuMTMyODEsLTAuMzgyODIgYyAtMzIuMjAzMTIsLTMuODcxMDkgLTU2Ljk4MDQ3LC0zMS40NzI2NSAtNTYuNTkzNzUsLTY0LjY0NDUzIDAuMjAzMTMsLTE3LjI4OTA2IDcuMjA3MDMsLTMyLjkwMjM0IDE4LjQzMzYsLTQ0LjMzNTkzIGwgLTAuMjY5NTQsLTAuNzczNDQgLTUyLjk4ODI4LDM3LjQ2ODc1IHogbSAwLDAiCiAgICAgICBpZD0icGF0aDQ2NjIiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOiMyODVjNzM7ZmlsbC1vcGFjaXR5OjE7ZmlsbC1ydWxlOm5vbnplcm87c3Ryb2tlOm5vbmUiCiAgICAgICBkPSJtIDM5My42NzE4Nyw1ODQuNTMxMjUgYyAwLDAgMi44ODI4MiwyNS4wNzQyMiAyLjE4MzYsMjQuMzU5MzcgLTI2Ljc0MjE5LC0zNS4yMjY1NiAtNjIuODM5ODUsLTI0LjcxNDg0IC02Mi44Mzk4NSwtMjQuNzE0ODQgbCAwLjEzNjcyLDAuMzgyODEgYyAzMi4xOTkyMiwzLjg3MTEgNTYuOTgwNDcsMzEuNDcyNjYgNTYuNTg5ODUsNjQuNjQ0NTMgLTAuMjAzMTMsMTcuMjg5MDcgLTcuMjAzMTMsMzIuOTAyMzUgLTE4LjQyOTY5LDQ0LjMzNTk0IGwgMC4yNjk1MywwLjc2OTUzIDUyLjk4ODI4LC0zNy40Njg3NSB6IG0gMCwwIgogICAgICAgaWQ9InBhdGg0NjY0IgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojMjg1YzczO2ZpbGwtb3BhY2l0eToxO2ZpbGwtcnVsZTpub256ZXJvO3N0cm9rZTpub25lIgogICAgICAgZD0ibSAzMzguMzc1LDYzMS4xNzU3OCBjIC0yOC4xOTUzMSwtMTEuMjc3MzQgLTQ1LjU1ODU5LC0yLjM3NSAtNDUuNTU4NTksLTIuMzc1IDAsMCAwLjE0ODQzLDUuOTMzNTkgMC4xNDg0Myw2LjIzMDQ3IDIuODIwMzIsMC44OTA2MiAtMC44ODY3MiwyMy43NDYwOSAxOS4xNDQ1MywyNC4wMzkwNiAyMC4wMzEyNSwwLjI5Njg4IDIyLjQwNjI1LC0xNS40Mjk2OSAyMy43NDIxOSwtMTguNTQ2ODcgMS4zMzU5NCwtMy4xMTcxOSAzLjc4NTE2LC0zLjExNzE5IDUuMTE3MTksMCAxLjMzNTk0LDMuMTE3MTggMy43NSwxOC44NDM3NSAyMy43ODEyNSwxOC41NDY4NyAyMC4wMzUxNiwtMC4yOTI5NyAxNi4zNTE1NiwtMjMuMTQ4NDQgMTkuMTcxODcsLTI0LjAzOTA2IDAsLTAuMjk2ODggMC4wNzgxLC02LjIzMDQ3IDAuMDc4MSwtNi4yMzA0NyAwLDAgLTE3LjQyOTY5LC04LjkwMjM0IC00NS42MjUsMi4zNzUiCiAgICAgICBpZD0icGF0aDQ2NjYiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIiAvPgogIDwvZz4KPC9zdmc+Cg==" alt="logo MQTT.Cool" width="1000"></span> Clustering for Load Balancing and Fail Over</h1>
<div class="details">
<span id="author" class="author">Support Team</span><br>
<span id="email" class="email"><a href="mailto:support@lightstreamer.com">support@lightstreamer.com</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a></li>
<li><a href="#_http_based_scenarios">2. HTTP-Based Scenarios</a>
<ul class="sectlevel2">
<li><a href="#_leverage_lb_stickiness_options_1_a">2.1. Leverage LB Stickiness – Options 1.A</a>
<ul class="sectlevel3">
<li><a href="#Option_1.A.1">2.1.1. Option 1.A.1 – IP-Address Based</a></li>
<li><a href="#Option_1.A.2">2.1.2. Option 1.A.2 – Cookie Based</a></li>
</ul>
</li>
<li><a href="#_leverage_application_stickiness_options_1_b">2.2. Leverage Application Stickiness – Options 1.B</a>
<ul class="sectlevel3">
<li><a href="#_option_1_b_1_servers_behind_the_load_balancer">2.2.1. Option 1.B.1 – Servers Behind the Load Balancer</a></li>
<li><a href="#_option_1_b_2_servers_partially_behind_the_load_balancer">2.2.2. Option 1.B.2 – Servers Partially Behind the Load Balancer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#https_based_scenarios">3. HTTPS-Based Scenarios</a>
<ul class="sectlevel2">
<li><a href="#_leverage_lb_stickiness_options_2_a">3.1. Leverage LB Stickiness – Options 2.A</a>
<ul class="sectlevel3">
<li><a href="#_option_2_a_1_ip_address_based">3.1.1. Option 2.A.1 – IP-Address Based</a>
<ul class="sectlevel4">
<li><a href="#example_multihosting_1">3.1.1.1. Example of Multihosting</a></li>
</ul>
</li>
<li><a href="#_option_2_a_2_cookie_based">3.1.2. Option 2.A.2 – Cookie Based</a></li>
</ul>
</li>
<li><a href="#_leverage_application_stickiness_options_2_b">3.2. Leverage Application Stickiness – Options 2.B</a>
<ul class="sectlevel3">
<li><a href="#Option_2.B.1">3.2.1. Leverage Multi-Domain SSL Certificates – Options 2.B.1</a>
<ul class="sectlevel4">
<li><a href="#_option_2_b_1_1_servers_behind_the_load_balancer">3.2.1.1. Option 2.B.1.1 – Servers Behind the Load Balancer</a></li>
<li><a href="#_option_2_b_1_2_servers_partially_behind_the_load_balancer">3.2.1.2. Option 2.B.1.2 – Servers Partially Behind the Load Balancer</a></li>
<li><a href="#_option_2_b_1_3_servers_behind_an_ssl_accelerator">3.2.1.3. Option 2.B.1.3 – Servers Behind an SSL Accelerator</a></li>
<li><a href="#_option_2_b_1_4_servers_partially_behind_an_ssl_accelerator">3.2.1.4. Option 2.B.1.4 – Servers Partially Behind an SSL Accelerator</a></li>
</ul>
</li>
<li><a href="#_leverage_individual_certificates_options_2_b_2">3.2.2. Leverage Individual Certificates – Options 2.B.2</a>
<ul class="sectlevel4">
<li><a href="#_option_2_b_2_1_servers_behind_the_load_balancer">3.2.2.1. Option 2.B.2.1 – Servers Behind the Load Balancer</a></li>
<li><a href="#_option_2_b_2_2_servers_partially_behind_the_load_balancer">3.2.2.2. Option 2.B.2.2 – Servers Partially Behind the Load Balancer</a></li>
<li><a href="#_option_2_b_2_3_servers_behind_an_ssl_accelerator">3.2.2.3. Option 2.B.2.3 – Servers Behind an SSL Accelerator</a></li>
<li><a href="#_option_2_b_2_4_servers_partially_behind_an_ssl_accelerator">3.2.2.4. Option 2.B.2.4 – Servers Partially Behind an SSL Accelerator</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#stickiness_expiration">4. Stickiness Expiration</a></li>
<li><a href="#force_rebalancing">5. How to Force a Rebalancing</a>
<ul class="sectlevel2">
<li><a href="#_when_lb_stickiness_is_leveraged">5.1. When LB Stickiness Is Leveraged</a></li>
<li><a href="#_when_application_stickiness_is_leveraged">5.2. When Application Stickiness Is Leveraged</a></li>
<li><a href="#_notes_on_instance_replacement">5.3. Notes on Instance Replacement</a></li>
</ul>
</li>
<li><a href="#_accessing_server_instances_directly_and_the_monitoring_dashboard_case">6. Accessing Server Instances Directly and the Monitoring Dashboard Case</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><a class="image" href="https://docs.mqtt.cool/server/guides/MQTT.Cool+Clustering.pdf"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pjxzdmcgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTI4IDEyODsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPjxnLz48ZyBpZD0iUHMiLz48ZyBpZD0iQWkiLz48ZyBpZD0iQWlfZG93bmxvYWQiLz48ZyBpZD0iSW1hZ2UiLz48ZyBpZD0iSW1hZ2VfZG93bmxvYWQiLz48ZyBpZD0iVmlkZW8iLz48ZyBpZD0iVmlkZW9fZG93bmxvYWQiLz48ZyBpZD0iUHNfZG93bmxvYWQiLz48ZyBpZD0iRG9jIi8+PGcgaWQ9IkRvY19kb3dubG9hZCIvPjxnIGlkPSJNdXNpYyIvPjxnIGlkPSJNdXNpY19kb3dubG9hZCIvPjxnIGlkPSJQZGYiLz48ZyBpZD0iUGRmX2Rvd25sb2FkIj48Zz48Zz48cGF0aCBkPSJNOTUuMjEsODAuMzJjLTAuMDctMC41MS0wLjQ4LTEuMTUtMC45Mi0xLjU4Yy0xLjI2LTEuMjQtNC4wMy0xLjg5LTguMjUtMS45NSAgICAgYy0yLjg2LTAuMDMtNi4zLDAuMjItOS45MiwwLjczYy0xLjYyLTAuOTMtMy4yOS0xLjk1LTQuNi0zLjE4Yy0zLjUzLTMuMjktNi40Ny03Ljg2LTguMzEtMTIuODljMC4xMi0wLjQ3LDAuMjItMC44OCwwLjMyLTEuMyAgICAgYzAsMCwxLjk4LTExLjI4LDEuNDYtMTUuMWMtMC4wNy0wLjUyLTAuMTItMC42Ny0wLjI2LTEuMDhsLTAuMTctMC40NGMtMC41NC0xLjI1LTEuNi0yLjU3LTMuMjYtMi41TDYwLjMyLDQxSDYwLjMgICAgIGMtMS44NiwwLTMuMzYsMC45NS0zLjc2LDIuMzZjLTEuMiw0LjQ0LDAuMDQsMTEuMDksMi4yOSwxOS42OWwtMC41OCwxLjRjLTEuNjEsMy45NC0zLjYzLDcuOS01LjQxLDExLjM5bC0wLjIzLDAuNDUgICAgIGMtMS44OCwzLjY3LTMuNTgsNi43OS01LjEzLDkuNDNsLTEuNTksMC44NGMtMC4xMiwwLjA2LTIuODUsMS41MS0zLjQ5LDEuODljLTUuNDMsMy4yNS05LjAzLDYuOTMtOS42Myw5Ljg1ICAgICBjLTAuMTksMC45NC0wLjA1LDIuMTMsMC45MiwyLjY4bDEuNTQsMC43OGMwLjY3LDAuMzMsMS4zOCwwLjUsMi4xLDAuNWMzLjg3LDAsOC4zNi00LjgyLDE0LjU1LTE1LjYyICAgICBjNy4xNC0yLjMyLDE1LjI4LTQuMjYsMjIuNDEtNS4zMmM1LjQzLDMuMDUsMTIuMTEsNS4xOCwxNi4zMyw1LjE4YzAuNzUsMCwxLjQtMC4wNywxLjkyLTAuMjFjMC44MS0wLjIyLDEuNDktMC42OCwxLjkxLTEuMyAgICAgQzk1LjI3LDgzLjc2LDk1LjQzLDgyLjA2LDk1LjIxLDgwLjMyeiBNMzYuNDksOTkuMzNjMC43LTEuOTMsMy41LTUuNzUsNy42My05LjEzYzAuMjYtMC4yMSwwLjktMC44MSwxLjQ4LTEuMzcgICAgIEM0MS4yOCw5NS43MiwzOC4zOSw5OC40NiwzNi40OSw5OS4zM3ogTTYwLjk1LDQzYzEuMjQsMCwxLjk1LDMuMTMsMi4wMSw2LjA3YzAuMDYsMi45NC0wLjYzLDUtMS40OCw2LjUzICAgICBjLTAuNzEtMi4yNi0xLjA1LTUuODItMS4wNS04LjE1QzYwLjQzLDQ3LjQ1LDYwLjM4LDQzLDYwLjk1LDQzeiBNNTMuNjUsODMuMTRjMC44Ny0xLjU1LDEuNzctMy4xOSwyLjY5LTQuOTIgICAgIGMyLjI1LTQuMjUsMy42Ny03LjU3LDQuNzItMTAuM2MyLjEsMy44Miw0LjcyLDcuMDcsNy43OSw5LjY3YzAuMzksMC4zMiwwLjgsMC42NSwxLjIyLDAuOThDNjMuODIsNzkuOCw1OC40MSw4MS4zMSw1My42NSw4My4xNHogICAgICBNOTMuMDgsODIuNzljLTAuMzgsMC4yMy0xLjQ3LDAuMzctMi4xNywwLjM3Yy0yLjI2LDAtNS4wNy0xLjAzLTktMi43MmMxLjUxLTAuMTEsMi45LTAuMTcsNC4xNC0wLjE3ICAgICBjMi4yNywwLDIuOTQtMC4wMSw1LjE3LDAuNTZDOTMuNDQsODEuNCw5My40Nyw4Mi41NSw5My4wOCw4Mi43OXoiIHN0eWxlPSJmaWxsOiNGRjQwMkY7Ii8+PC9nPjxnPjxwYXRoIGQ9Ik0xMDQsODBjLTEzLjI1NSwwLTI0LDEwLjc0NS0yNCwyNHMxMC43NDUsMjQsMjQsMjRzMjQtMTAuNzQ1LDI0LTI0UzExNy4yNTUsODAsMTA0LDgweiAgICAgIE0xMTQuODgyLDk2Ljk4OGwtMC4xMTMsMC4xNzZsLTguMjMyLDExLjQzOEMxMDUuOTg5LDEwOS40NjgsMTA1LjAyOSwxMTAsMTA0LDExMHMtMS45ODktMC41MzItMi41MzYtMS4zOTdsLTguMzQ2LTExLjYxNCAgICAgYy0wLjUyOS0wLjkyNi0wLjUyNC0yLjA3MywwLjAxLTIuOTk0YzAuNTM1LTAuOTIyLDEuNTMtMS40OTQsMi41OTYtMS40OTRIMTAwVjg2YzAtMS42NTQsMS4zNDYtMywzLTNoMmMxLjY1NCwwLDMsMS4zNDYsMywzdjYuNSAgICAgaDQuMjc2YzEuMDY1LDAsMi4wNjEsMC41NzIsMi41OTYsMS40OTRDMTE1LjQwNiw5NC45MTUsMTE1LjQxMSw5Ni4wNjMsMTE0Ljg4Miw5Ni45ODh6IiBzdHlsZT0iZmlsbDojRkY0MDJGOyIvPjxnPjxwb2x5Z29uIHBvaW50cz0iODQsMTI1Ljk1IDgzLjk1LDEyNiA4NCwxMjYgICAgICIgc3R5bGU9ImZpbGw6I0ZGOUEzMDsiLz48cG9seWdvbiBwb2ludHM9IjExNCw3NyAxMTQsNzYuOTUgMTEzLjk1LDc3ICAgICAiIHN0eWxlPSJmaWxsOiNGRjlBMzA7Ii8+PHBhdGggZD0iTTExMS4wNzEsNDQuMjQzTDcxLjc1Nyw0LjkyOUM2OS44NjksMy4wNDEsNjcuMzU3LDIsNjQuNjg3LDJIMjRjLTUuNTE0LDAtMTAsNC40ODYtMTAsMTB2MTA0ICAgICAgYzAsNS41MTQsNC40ODYsMTAsMTAsMTBoNTkuOTVsLTQtNEgyNGMtMy4zMDksMC02LTIuNjkxLTYtNlYxMmMwLTMuMzA5LDIuNjkxLTYsNi02aDQwLjY4N2MxLjYwMywwLDMuMTA5LDAuNjI0LDQuMjQyLDEuNzU3ICAgICAgbDM5LjMxNCwzOS4zMTRjMS4xMTYsMS4xMTcsMS43NTcsMi42NjMsMS43NTcsNC4yNDJWNzIuOTVsNCw0VjUxLjMxM0MxMTQsNDguNjQzLDExMi45Niw0Ni4xMzIsMTExLjA3MSw0NC4yNDN6IiBzdHlsZT0iZmlsbDojRkY0MDJGOyIvPjxwb2x5bGluZSBwb2ludHM9IjExMy45NSw3NyAxMTQsNzYuOTUgMTEwLDcyLjk1ICAgICAiIHN0eWxlPSJmaWxsOiNGRkZGRkY7Ii8+PC9nPjwvZz48L2c+PC9nPjxnIGlkPSJXb3JkIi8+PGcgaWQ9IldvcmRfZG93bmxvYWQiLz48ZyBpZD0iRXhlbCIvPjxnIGlkPSJFeGVsX2Rvd25sb2FkIi8+PGcgaWQ9IlBvd2VycG9pbnQiLz48ZyBpZD0iUG93ZXJwb2ludF9kb3dubG9hZCIvPjxnIGlkPSJaaXAiLz48ZyBpZD0iWmlwX2Rvd25sb2FkIi8+PC9zdmc+" alt="pdf download" width="30"></a></span> <a href="https://docs.mqtt.cool/server/guides/MQTT.Cool+Clustering.pdf">Download PDF</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Clustering of MQTT.Cool servers is achieved through any standard Load Balancer (LB), including physical appliances by Cisco, F5, etc., and cloud-based balancers such as Amazon AWS ELB.<br>
Software-based load balancer are usually less effective, because they tend to introduce intermediate buffers, which hide the actual status of the TCP connection between the client and the server (MQTT.Cool monitors such status in order to throttle bandwidth and manage network
congestions).</p>
</div>
<div class="paragraph">
<p>In any case, the LB should be configured in such a way that data packets are forwarded to the clients immediately, without any buffering. Buffering the response will make the client switch from streaming mode to polling mode.</p>
</div>
<div class="paragraph">
<p>The MQTT.Cool Clients can use two different Layer-7 protocols to communicate with MQTT.Cool: <strong>HTTP</strong> and <strong>WebSocket</strong>.
In case the WebSocket protocol is not supported by the LB, MQTT.Cool automatically falls back to HTTP.
The LB should always be configured to make HTTP work properly.
Being able to support WebSockets too is highly recommended, but not strictly required.
If you cannot configure the LB to support WebSockets, then, upon the client attempt to use WebSockets, the connection may become unresponsive; in this case, the automatic fallback action may take a few seconds.
To avoid the delay, it may be preferable to disable WebSocket support directly on the server, by setting to N the <code>&lt;enabled&gt;</code> element within the <code>&lt;websocket&gt;</code> block in <code>configuration.xml</code>.</p>
</div>
<div class="paragraph">
<p>The MQTT.Cool Clients create two categories of connections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>S</strong>: The session creation connection, which is the first connection in the lifecycle of an MQTT.Cool client session.<br>
Through this interaction, the client authenticates and gets its client-id.
Depending on the client implementation, this connection may be a short lived HTTP POST request, or it may be long lived and implement the actual streaming channel, over either HTTP or WebSocket.<br>
Upon unexpected session termination (usually due to a disconnection), another "S" type connection is done by the client.<br>
These connections can always be freely balanced (with no stickiness requirements).</p>
</li>
<li>
<p><strong>CR</strong>: The control and rebind connections, which are used for sending subscriptions and other commands and for implementing the streaming channel in many cases.<br>
These connections can be based on either HTTP or WebSocket.<br>
These connections require to be sticky to the server that has served the corresponding session creation connection.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In case of WebSocket, subscriptions and other commands can be issued on the same WebSocket that is hosting the streaming channel.
Doing this obviously ensures the stickiness, but it is not always possible.<br>
Therefore, the cluster configuration has to ensure the stickiness property.</p>
</div>
<div class="paragraph">
<p>Usually, the LB should be configured to switch traffic at Layer 7 (HTTP).
But there are cases (especially with WebSockets) where configuring traffic switch at Layer 4 (TCP) enhances compatibility.<br>
Configuring LS at Layer 4 usually has some consequences:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Cookie-based stickiness is not supported.</p>
</li>
<li>
<p>X-Forwarded headers are not supported. Such HTTP headers are inserted by the LB to preserve the actual IP address, protocol, and port of the originating client.
But a good alternative exists at Layer 4: the <a href="http://www.haproxy.org/download/1.5/doc/proxy-protocol.txt">Poxy Protocol</a>. It is supported by MQTT.Cool and allows to preserve the originating client address even without the HTTP headers.
Furthermore, in some cases a Layer-4 acts as a real low-level switch, so that the originating IP might be kept directly.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Browser-based clients may pose additional constraints depending on the kind of deployment and on the target browsers.
Ignoring these constraints may lead to less than optimal connections on some browsers.
Note that in all cases (as we will see below) in which the <code>&lt;control_link_address&gt;</code> setting is leveraged, the Server can be addressed through different hostnames, so the constraints should be considered with regard to all hostnames involved.</p>
</div>
<div class="paragraph">
<p>To illustrate the available options for the cluster configurations, let&#8217;s suppose that MQTT.Cool has been deployed on two boxes (so that the cluster contains two nodes).
All the different solutions explained in the following chapters can be naturally extended to the cases where more nodes are used.
Fictitious public and private IP addresses and hostnames will be used in the examples.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_http_based_scenarios">2. HTTP-Based Scenarios</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_leverage_lb_stickiness_options_1_a">2.1. Leverage LB Stickiness – Options 1.A</h3>
<div class="paragraph">
<p>The <strong>sticky</strong> property of the Load Balancer is leveraged.
Usually Load Balancers offer at least two types of stickiness mechanisms, which leads to two distinct options:</p>
</div>
<div class="sect3">
<h4 id="Option_1.A.1">2.1.1. Option 1.A.1 – IP-Address Based</h4>
<div class="paragraph">
<p>The Balancer routes the requests based on the source IP address. After a request from a new IP address is received, all the subsequent requests from the same IP address are routed to the same node chosen for the first request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please bear in mind that some Internet providers exist that dynamically change the source IP address throughout different requests coming from the same Client. So the IP-address based mechanism is not always reliable, making the "cookie-based" one preferable.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The network configuration is like the following one:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S, CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing + sticky)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>configuration.xml</code> file will be the same for both Servers and will contain the following element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
<span class="tag">&lt;/http_server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No clustering configuration through the &lt;control_link_address&gt; element is necessary.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: If the Balancer does not support WebSocket, it is suggested to configure it at Layer 4 (TCP), rather than at Layer 7 (HTTP).</p>
</div>
</div>
<div class="sect3">
<h4 id="Option_1.A.2">2.1.2. Option 1.A.2 – Cookie Based</h4>
<div class="paragraph">
<p>The Balancer must support a "Sticky Cookie-Insert" mode, that means that a suitable session cookie is inserted by the Balancer in the responses.
Subsequent requests from the Client will send the cookie back, so that the Balancer will be able to correctly route them.</p>
</div>
<div class="paragraph">
<p>The network configuration is like the following one:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S, CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing + sticky)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>configuration.xml</code> file will be the same for both Servers and will contain the following element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
<span class="tag">&lt;/http_server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No clustering configuration through the <code>&lt;control_link_address&gt;</code> element is necessary.</p>
</div>
<div class="paragraph">
<p>In order for the technique of inserting the "Sticky Cookie" to be successful, it is required that the client application manages cookies according with RFC 6265.
In this way, session cookies set by the Load Balancer will be sent back by the client upon any further connection to the same domain.<br>
This is normal behaviour for browsers and all applications running in a browser context can take advantage of that.
For standalone applications, this property may have to be enforced by the SDK library or even at application level.</p>
</div>
<div class="paragraph">
<p>Depending on the environment,
the following setting may need to be added to the client initialization code, before connecting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">lsClient.connectionOptions.setCookieHandlingRequired (<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This has the effect of disabling transports for which cookie handling is not available.<br></p>
</div>
<div class="paragraph">
<p>The
following should also be added to the client initialization code, before connecting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">lsClient.connectionOptions.setEarlyWSOpenEnabled(<span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: As this option works at Layer 7 (Layer 4 is impossible because it does not allow cookie insertion), it is required that the Balancer supports WebSocket.<br>
Note that WebSocket is not currently used by
non-browser client SDK
, which rely exclusively on HTTP(S).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_leverage_application_stickiness_options_1_b">2.2. Leverage Application Stickiness – Options 1.B</h3>
<div class="paragraph">
<p>With these options, stickiness is provided by application-level mechanisms, rather than leveraging the stickiness mechanisms offered by the Load Balancer.</p>
</div>
<div class="paragraph">
<p>As we will show, this involves the setting of the <code>&lt;control_link_address&gt;</code> Server configuration element.
This setting specifies a hostname that addresses the Server instance directly.
As such, it should be different for each instance and from the Balancer hostname.
This allows the instance reached through the "S" connection to notify itself to the client, which, in turn, will issue the "CR" connections directly to that instance.</p>
</div>
<div class="paragraph">
<p>The possibility to address "S" and "CR" connections to different hostnames also allows for the possibility to receive them on different listening ports on the Server instances.
This is not necessary in the scenarios analyzed below, where both possibilities (i.e. single port or two ports) can be configured.
However, the two-ports configuration is strongly recommended,
because it enables the use of the <code>&lt;port_type&gt;</code> configuration setting on the ports, which, in turn, leverages the backpressure features provided by the Server.<br>
In the examples below, we will always show and suggest the two-ports configuration.</p>
</div>
<div class="sect3">
<h4 id="_option_1_b_1_servers_behind_the_load_balancer">2.2.1. Option 1.B.1 – Servers Behind the Load Balancer</h4>
<div class="paragraph">
<p>The final nodes can be directly addressed by the Client through dedicated hostnames, which the Load Balancer uses to determine the MQTT.Cool server box to forward the request to.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">81</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The first column of the table above shows the types of connection that will reach the target box.<br>
The two instances of MQTT.Cool do not need to have any public IP addresses, because name-based virtual hosting is used in the Load Balancer.
All of the requests will reach the Load Balancer, which must adopt a routing algorithm based on the hostname with which the request is received (L7 or HTTP switching).<br>
If the host name is <code>mqtt</code>, it will use the balancing algorithm (e.g. round robin).<br>
If the host name is <code>mqtt1</code>, it will send the request to Server 1.<br>
If the host name is <code>mqtt2</code>, it will send the request to Server 2.</p>
</div>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>81<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>81<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As anticipated, the separation between ports 80 and 81 is optional; a single S+CR port can be used, although this would prevent the possibility to specify the port type and take advantage of the associated benefits.</p>
</div>
<div class="paragraph">
<p>Notice that a solution based on the use of three different VIPs on the Load Balancer (rather than doing L7 switching) is also possible.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: Name-based virtual hosting works at Layer 7 (Layer 4 is impossible because it does not allow inspection of the Host HTTP header) hence it requires that the Balancer supports WebSocket.<br>
If the Balancer does not support WebSocket, it is still possible to configure it at Layer 4 (TCP), rather than at Layer 7 (HTTP) and use IP-based virtual hosting.</p>
</div>
<div class="paragraph">
<p><strong>Note on Multihosting</strong>: Only in case of a browser-based client, a multihosting environment may lead to some browsers using less than optimal connections to the MQTT.Cool servers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_option_1_b_2_servers_partially_behind_the_load_balancer">2.2.2. Option 1.B.2 – Servers Partially Behind the Load Balancer</h4>
<div class="paragraph">
<p>The final nodes can be directly accessed through public IP addresses assigned to the MQTT.Cool server boxes.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">81</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.01</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The two instances of MQTT.Cool should be directly reachable from the Internet (i.e. each of them has a public IP address), besides being reachable through the Load Balancer.
Here, we prefer to access the Server instances from the Load Balancer on a local port.
We emphasize this in our sample configuration by leveraging the possibility to specify different listening interfaces for the two listening ports.</p>
</div>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>81<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>10.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>200.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>81<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>10.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>200.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As anticipated, the separation between ports 80 and 81 is optional; a S+CR port 80, accessible on both public and private address, can be used, although this would prevent the possibility to specify the port type and take advantage of the associated benefits.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: This option is particularly useful If the Balancer does not support WebSocket. Only the "S" connection (which is always HTTP-based) passes through the Balancer, while the "CR" connections (which can be upgraded to WS) go straight to the MQTT.Cool servers.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="https_based_scenarios">3. HTTPS-Based Scenarios</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With HTTPS connections, the Balancer cannot see the content of the application HTTP request, because it is encrypted and only the final server can decode it.<br>
In practice, the LB must switch traffic at Layer 4 (TCP), with all related restrictions; so, for example, Option 1.B.1 is not possible.</p>
</div>
<div class="paragraph">
<p>However, as will be shown in some of the options below, it is also possible to use an <strong>SSL Acceleration</strong> (a.k.a. <strong>SSL offloading</strong>) module, a hardware component that off-loads the encryption/decryption operations from MQTT.Cool and then uses plain HTTP to
communicate with MQTT.Cool.<br>
In practice, an off-loading LB switches traffic at Layer 7 (HTTP), with all related limitations.
So, please consider that sometimes SSL offload/acceleration products introduce proxy connections at some level.
This could have a double impact on MQTT.Cool&#8217;s features:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the SSL module buffers the full response, before forwarding it to the client, the client will automatically switch from streaming mode to polling mode.</p>
</li>
<li>
<p>The connection that MQTT.Cool monitors is not the actual client connection, but is the connection with the SSL Accelerator; if the Accelerator introduces a TCP buffer, the adaptive streaming algorithms of MQTT.Cool could take a longer time to detect a network congestion.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>But HTTPS has a further complication with respect to HTTP, as the TLS/SSL handshake requires that the server sends a SSL Certificate consistent with the hostname used by the client to access the server.
Since the TLS/SSL handshake is usually performed before the application protocol (HTTP) can start (see <a href="http://en.wikipedia.org/wiki/Secure_Sockets_Layer#Support_for_name-based_virtual_servers" class="bare">http://en.wikipedia.org/wiki/Secure_Sockets_Layer#Support_for_name-based_virtual_servers</a> and <a href="https://www.switch.ch/pki/meetings/2007-01/namebased_ssl_virtualhosts.pdf" class="bare">https://www.switch.ch/pki/meetings/2007-01/namebased_ssl_virtualhosts.pdf</a>), the server has no way of determining the hostname used (usually reported in the "Host" HTTP header) and must assume it in advance.
In case the same server should be accessed with two or more different hostnames, it can&#8217;t but issue a certificate which is consistent with all such names. This is possible by using Wildcard SSL Certificates or Multi-Domain SSL Certificates.
When such a Multi-Domain certificate cannot be obtained, it is still possible to stick to multiple Single-Domain certificates and leverage different ports. We will show this technique as well, whereas both instances of MQTT.Cool and off-loading Balancers may be affected.</p>
</div>
<div class="sect2">
<h3 id="_leverage_lb_stickiness_options_2_a">3.1. Leverage LB Stickiness – Options 2.A</h3>
<div class="paragraph">
<p>The <strong>sticky</strong> property of the Load Balancer is leveraged. Usually Load Balancers offer at least two types of stickiness mechanisms, which leads to two distinct options.</p>
</div>
<div class="sect3">
<h4 id="_option_2_a_1_ip_address_based">3.1.1. Option 2.A.1 – IP-Address Based</h4>
<div class="paragraph">
<p>The Balancer routes the requests based on the source IP address. After a request from a new IP address is received, all the subsequent requests from the same IP address are routed to the same node chosen for the first request. The same considerations as in <a href="#Option_1.A.1">Section 2.1.1, &#8220;Option 1.A.1 – IP-Address Based&#8221;</a> apply from a theoretical point of view (potentially making this option unreliable), but client IP switching does not usually happen with HTTPS.</p>
</div>
<div class="paragraph">
<p>A simple SSL certificate for hostname <code>mqtt.mycompany.com</code> is needed.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S, CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing + sticky)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>configuration.xml</code> file will be the same for both Servers and will contain the following element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No clustering configuration through the <code>&lt;control_link_address&gt;</code> element is necessary.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: If the Balancer does not support WebSocket, it is possible to configure it at level-4 (TCP), rather than at level-7 (HTTP). This is already the case if SSL offloading is leveraged.</p>
</div>
<div class="sect4">
<h5 id="example_multihosting_1">3.1.1.1. Example of Multihosting</h5>
<div class="paragraph">
<p>By using a Multi-Domain SSL Certificate (see <a href="#Option_2.B.1">Section 3.2.1, &#8220;Leverage Multi-Domain SSL Certificates – Options 2.B.1&#8221;</a> below for details) the configuration remains similar to the Option 2.A.1 scenario.</p>
</div>
<div class="paragraph">
<p>If only two Single-Domain SSL Certificates are available, we must extend the configuration in order to allow each Server instance to provide different certificates based on the hostname with which it is accessed.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S, CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing + sticky)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S, CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.ourcompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing + sticky)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">444</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements, for both the MQTT.Cool server 1 and MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My HTTPS Server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mymqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Our HTTPS Server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>ourmqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar considerations apply to all the other cases in which individual SSL certificates have to be provided directly by MQTT.Cool.</p>
</div>
<div class="paragraph">
<p>Only in case of a browser-based client, a multihosting environment may lead to some browsers using less than optimal connections to the MQTT.Cool servers.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_option_2_a_2_cookie_based">3.1.2. Option 2.A.2 – Cookie Based</h4>
<div class="paragraph">
<p>The Balancer must support a "Sticky Cookie-Insert" mode, provided that the Load Balancer is extended with an <strong>SSL Acceleration module</strong> (otherwise the encrypted cookies would not be writable and readable by the Balancer). The same considerations as in <a href="#Option_1.A.2">Section 2.1.2, &#8220;Option 1.A.2 – Cookie Based&#8221;</a> apply.</p>
</div>
<div class="paragraph">
<p>A simple SSL certificate for hostname <code>mqtt.mycompany.com</code> is needed for the off-loading Balancer.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S, CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer + SSL Accel.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing + sticky)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>configuration.xml</code> file will be the same for both Servers and will contain the following element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
<span class="tag">&lt;/http_server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>No clustering configuration through the <code>&lt;control_link_address&gt;</code> element is necessary.</p>
</div>
<div class="paragraph">
<p>For browser-based clients, depending on the environment, the following setting may need to be added to the client initialization code, before connecting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">lsClient.connectionOptions.setCookieHandlingRequired (<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The
following should also be added to the client initialization code, before connecting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">lsClient.connectionOptions.setEarlyWSOpenEnabled(<span class="predefined-constant">false</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>For non-browser clients, see the additional notes provided in <a href="#Option_1.A.2">Section 2.1.2, &#8220;Option 1.A.2 – Cookie Based&#8221;</a>.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: As this option works at Layer 7 (Layer 4 is impossible because it does not allow cookie insertion), it is required that the Balancer supports WebSocket.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_leverage_application_stickiness_options_2_b">3.2. Leverage Application Stickiness – Options 2.B</h3>
<div class="paragraph">
<p>With these options, stickiness is provided by application-level mechanisms, rather than leveraging the stickiness mechanisms offered by the Load Balancer.</p>
</div>
<div class="paragraph">
<p>As we will show, this involves the setting of the <code>&lt;control_link_address&gt;</code> Server configuration element.
This setting specifies a hostname that addresses the Server instance directly.
As such, it should be different for each instance and from the Balancer hostname.
This allows the instance reached through the "S" connection to notify itself to the client, which, in turn, will issue the "CR" connections directly to that instance.</p>
</div>
<div class="paragraph">
<p>The possibility to address "S" and "CR" connections to different hostnames also allows for the possibility to receive them on different listening ports on the Server instances.
This is necessary in some of the scenarios analyzed below; in other scenarios, both possibilities (i.e. single port or two ports) can be configured.
However, the two-ports configuration is strongly recommended in all cases, because it enables the use of the <code>&lt;port_type&gt;</code> configuration setting on the ports, which, in turn, leverages the backpressure features provided by the Server.<br>
In the examples below, we will always show and suggest the two-ports configuration.</p>
</div>
<div class="paragraph">
<p>Note that a consequence of the two-ports configuration is that the TLS handshakes for "S" and "CR" connections are performed on different ports, so it is important that the TLS configurations of the two ports are the same; or, at least, the configuration of the "CR" port should not be more restrictive than the configuration of the "S" port, to prevent that, for some clients, a loop of successful session establishments followed by bind failures builds up.<br>
In principle, this is easy to achieve, but it may not be that easy when the Server is "partially behind an SSL Accelerator", as described below.
In this case, port "S" is handled by the accelerator while port "CR" is handled by MQTT.Cool server, so care should be taken to ensure that the two TSL configurations are consistent.</p>
</div>
<div class="sect3">
<h4 id="Option_2.B.1">3.2.1. Leverage Multi-Domain SSL Certificates – Options 2.B.1</h4>
<div class="paragraph">
<p>A Wildcard SSL Certificate helps enable SSL encryption on multiple sub-domains using a single certificate as long as the domains are controlled by the same organization and share the same second-level domain name.
For example, a certificate issued for name <code><strong>*.mycompany.com</strong></code> may be used to secure all the following domains: <code>mqtt.mycompany.com</code>, <code>mqtt1.mycompany.com</code>, <code>mqtt2.mycompany.com</code>.</p>
</div>
<div class="paragraph">
<p>The use of wildcards is restricted to domains that share the same second-level domain name.
However, the Subject Alternative Name (SAN) field of a SSL Certificate allows for the specification of multiple independent domain names, as long as they are controlled by the same organization.
The only drawback is that they must be determined in advance (instead, with a Wildcard Certificate, any newly created sub-domain is automatically allowed). Multiple domain names can be specified with a syntax of the SAN field like:
<code><strong>dns:mqtt.mycompany.com,dns:mqtt.ourcompany.com</strong></code>.</p>
</div>
<div class="paragraph">
<p>The two above techniques can be combined: a Wildcard Certificate issued with the SAN <code><strong>dns:*.mycompany.com,dns:*.ourcompany.com</strong></code> may be used to secure all the following domains: <code>mqtt1.mycompany.com</code>, <code>mqtt2.mycompany.com</code>, <code>mqtt1.ourcompany.com</code>, <code>mqtt2.ourcompany.com</code>.</p>
</div>
<div class="paragraph">
<p>The use of Wildcard Certificates and the SAN field is addressed in <a href="http://www.ietf.org/rfc/rfc2818.txt">RFC 28183</a>, section 3.1.
Browser compatibility is quite high, where typically only older micro-browsers do not support wildcard certificates or SAN (for example, see:
<a href="http://www.geocerts.com/ssl/browsers" class="bare">http://www.geocerts.com/ssl/browsers</a> and <a href="https://www.digicert.com/subject-alternative-name-compatibility.htm" class="bare">https://www.digicert.com/subject-alternative-name-compatibility.htm</a>).
For more information on wildcard certificates and the SAN field, including possible limitation, you may visit the specific pages of some well-known certification authorities sites (for example, see <a href="http://www.verisign.com/ssl-certificates/wildcard-ssl-certificates/" class="bare">http://www.verisign.com/ssl-certificates/wildcard-ssl-certificates/</a> and <a href="https://www.thawte.com/ssl-digital-certificates/wildcardssl/index.html" class="bare">https://www.thawte.com/ssl-digital-certificates/wildcardssl/index.html</a>).</p>
</div>
<div class="sect4">
<h5 id="_option_2_b_1_1_servers_behind_the_load_balancer">3.2.1.1. Option 2.B.1.1 – Servers Behind the Load Balancer</h5>
<div class="paragraph">
<p>A Wildcard SSL Certificate is issued for <code><strong>*.mycompany.com</strong></code>.<br>
Alternatively, an SSL Certificate with the SAN <code><strong>dns:mqtt.mycompany.com,dns:mqtt1.mycompany.com,dns:mqtt2.mycompany.com</strong></code> could be
issued.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">444</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Load Balancer needs to be exposed on multiple IP addresses (in this example three) in order to distinguish the final destination of the request, because it cannot read the encrypted hostname that is part of the HTTPS request (however it is necessary to use multiple hostnames, because the Web Client always needs to access the Server with a logical name and not an IP address, due to security restraints).</p>
</div>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The separation between ports 443 and 444 is optional here; a single S+CR port can be used, although this would prevent the possibility to specify the port type and take advantage of the associated benefits.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: As this option works at Layer 4 (Layer 7 is impossible because SSL offloading is not being used), WebSocket should always work with no issues.</p>
</div>
<div class="sect5">
<h6 id="example_multihosting_2">Example of Multihosting</h6>
<div class="paragraph">
<p>As already pointed out in <a href="#example_multihosting_1">Section 3.1.1.1, &#8220;Example of Multihosting&#8221;</a>, only in case of a browser-based client a multihosting environment may lead to some browsers using less than optimal connections to the MQTT.Cool servers.</p>
</div>
<div class="paragraph">
<p>In this example, Option 2.B.1.1 is used to implement a multihosting scenario, where the same MQTT.Cool servers are used to serve clients connected to different domains (e.g. <code>mycompany.com</code> and <code>ourcompany.com</code>).</p>
</div>
<div class="paragraph">
<p>By using a single Wildcard SSL Certificate with the SAN <code><strong>dns:*.mycompany.com,dns:*.ourcompany.com</strong></code>, the configuration remains similar to the Option
2.B.1.1 scenario.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s examine the case in which Wildcard SSL Certificates are available but different second-level domains cannot be combined in a single certificate.<br>
Hence, two Wildcard SSL Certificates for, respectively, <code><strong>*.mycompany.com</strong></code> and <code><strong>*.ourcompany</strong></code> are needed for the two different domains,</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">445</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.ourcompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">446</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.ourcompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">444</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.ourcompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">444</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>445<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mymqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mymqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Our HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>446<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_ourmqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Our HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_ourmqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>445<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mymqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mymqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Our HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>446<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_ourmqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Our HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_ourmqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The separations between ports 443 and 445 and between ports 444 and 446 ars optional here; single S+CR ports can be used in the two cases, although this would prevent the possibility to specify the port type and take advantage of the associated benefits.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_option_2_b_1_2_servers_partially_behind_the_load_balancer">3.2.1.2. Option 2.B.1.2 – Servers Partially Behind the Load Balancer</h5>
<div class="paragraph">
<p>A Wildcard SSL Certificate is issued for <code><strong>*.mycompany.com</strong></code>, to be used for both the two Server instances and the off-loading Balancer.<br>
Alternatively, an SSL Certificate with the SAN <code><strong>dns:mqtt.mycompany.com,dns:mqtt1.mycompany.com,dns:mqtt2.mycompany.com</strong></code> could be
issued.</p>
</div>
<div class="paragraph">
<p>The final nodes can be directly accessed through public IP addresses assigned to the MQTT.Cool server boxes.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">444</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The two instances of MQTT.Cool should be directly reachable from the Internet (i.e. each of them has a public IP address), besides being reachable through the Load Balancer.
Here, we prefer to access the Server instances from the Load Balancer on a local port.
We emphasize this in our sample configuration by leveraging the possibility to specify different listening interfaces for the two listening ports.</p>
</div>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>10.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>200.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>10.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>200.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The separation between ports 443 and 444 is optional here; a S+CR port 443, accessible from both private and public address, can be used, although this would prevent the possibility to specify the port type and take advantage of the associated benefits.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: Only the "S" connection (which is always HTTPS-based) passes through the Balancer, while the "CR" connections (which can be upgraded to WSS) go straight to the MQTT.Cool servers.<br>
Furthermore, this option works at Layer 4 (Layer 7 is impossible because SSL offloading is not being used). So, WebSocket should always work with no issues.</p>
</div>
</div>
<div class="sect4">
<h5 id="_option_2_b_1_3_servers_behind_an_ssl_accelerator">3.2.1.3. Option 2.B.1.3 – Servers Behind an SSL Accelerator</h5>
<div class="paragraph">
<p>An external SSL Accelerator is used to offload the SSL operations, though the limitations outlined at the beginning of <a href="#https_based_scenarios">Chapter 3, <em>HTTPS-Based Scenarios</em></a> should be taken into consideration.</p>
</div>
<div class="paragraph">
<p>The Load Balancer is extended with an SSL Acceleration module, that takes care of the encryption/decryption operations and uses HTTP to communicate with the final cluster nodes.<br>
A Wildcard SSL Certificate is issued for <code><strong>*.mycompany.com</strong></code>, to be used on the off-loading Balancer.<br>
Alternatively, an SSL Certificate with the SAN <code><strong>dns:mqtt.mycompany.com,dns:mqtt1.mycompany.com,dns:mqtt2.mycompany.com</strong></code> could be issued.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer + SS Accel.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">81</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer + SS Accel.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer + SS Accel.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>lghtstreamer_conf.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>81<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>81<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The separation between ports 80 and 81 is optional here; a single S+CR port can be used, although this would prevent the possibility to specify the port type and take advantage of the associated benefits.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: If the Balancer does not support WebSocket, configuring it at Layer 4 (TCP) can in some cases make WebSocket work, provided that the Balancer supports Layer-4 SSL offloading.</p>
</div>
</div>
<div class="sect4">
<h5 id="_option_2_b_1_4_servers_partially_behind_an_ssl_accelerator">3.2.1.4. Option 2.B.1.4 – Servers Partially Behind an SSL Accelerator</h5>
<div class="paragraph">
<p>A Wildcard SSL Certificate is issued for <code><strong>*.mycompany.com</strong></code>, to be used for both the two Server instances and the off-loading Balancer.<br>
Alternatively, an SSL Certificate with the SAN <code><strong>dns:mqtt.mycompany.com,dns:mqtt1.mycompany.com,dns:mqtt2.mycompany.com</strong></code> could be
issued.</p>
</div>
<div class="paragraph">
<p>The final nodes can be directly accessed through public IP addresses assigned to the MQTT.Cool servers boxes.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer + SS Accel.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The two instances of MQTT.Cool listen to HTTP requests on a private-IP socket AND to HTTPS requests on a public-IP socket.
We emphasize this in our sample configuration by leveraging the possibility to specify different listening interfaces for the two listening ports.<br>
The Balancer balances the incoming "S" connections, while the "CR" connections are directly sent to the final MQTT.Cool servers.</p>
</div>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>10.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>200.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span>
<span class="tag">&lt;prestarted_max_queue&gt;</span>1000<span class="tag">&lt;/prestarted_max_queue&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>10.0.0.2<span class="tag">&lt;/listening_interface&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>200.0.0.2<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>wildcard_mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span>
<span class="tag">&lt;prestarted_max_queue&gt;</span>1000<span class="tag">&lt;/prestarted_max_queue&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;prestarted_max_queue&gt;</code> setting is recommended here, in order to leverage the backpressure features provided by the Server.
In fact, in this particular configuration, the "CR" connections, being the only ones in TLS/SSL, may be slower than the "S" connections in the establishment phase.
This may pose problems,
whereas, in case of massive client arrival, this may originate a queue of session establishment requests waiting for the final rebind connection, with growing session establishment latencies.
The <code>&lt;prestarted_max_queue&gt;</code> setting puts a limit on this queue; the best value should be determined experimentally.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: This option is particularly useful If the Balancer does not support WebSocket. Only the "S" connection (which is always HTTPS-based) passes through the Balancer, while the "CR" connections (which can be upgraded to WSS) go straight to the MQTT.Cool servers.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_leverage_individual_certificates_options_2_b_2">3.2.2. Leverage Individual Certificates – Options 2.B.2</h4>
<div class="paragraph">
<p>If only Single-Domain SSL Certificates are available, individual certificates should be issued for each hostname used in the cluster.
The configurations shown for the previous options 2.B.1 have to be extended as follows.</p>
</div>
<div class="sect4">
<h5 id="_option_2_b_2_1_servers_behind_the_load_balancer">3.2.2.1. Option 2.B.2.1 – Servers Behind the Load Balancer</h5>
<div class="paragraph">
<p>Two different SSL certificates (for two different hostnames) need to be handled by each node of MQTT.Cool server, which needs to create two server sockets associated to two different keystores. For example, the server socket on port 444 will handle the <code>mqtt.mycompany.com</code> certificate, while the server socket on port 443 will handle the <code>mqtt1.mycompany.com</code> certificate.
A total of three certificates are needed in this example.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">444</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Load Balancer needs to be exposed on multiple IP addresses (in this example three) in order to distinguish the final destination of the request, because it cannot read the encrypted hostname that is part of the HTTPS request (however it is necessary to use multiple hostnames, because the Web Client always needs to access the Server with a logical name and not an IP address, due to security restraints).</p>
</div>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt1.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt2.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: As this option works at Layer 4 (Layer 7 is impossible because SSL offloading is not being used), WebSocket should always work with no issues.</p>
</div>
<div class="sect5">
<h6 id="_example_of_multihosting">Example of Multihosting</h6>
<div class="paragraph">
<p>As already pointed out in <a href="#example_multihosting_1">Section 3.1.1.1, &#8220;Example of Multihosting&#8221;</a> and <a href="#example_multihosting_2">Section 3.2.1.1.1, &#8220;Example of Multihosting&#8221;</a>, only in case of a browser-based client, a multihosting environment may lead to some browsers using less than optimal connections to the MQTT.Cool servers.</p>
</div>
<div class="paragraph">
<p>In this example, Option 2.B.2.1 is used to implement a multihosting scenario, where the same MQTT.Cool servers are used to serve clients connected to different domains (e.g. <code>mycompany.com</code> and <code>ourcompany.com</code>).</p>
</div>
<div class="paragraph">
<p>Six SSL certificates are needed for the six different hostnames involved.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">445</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.ourcompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">446</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.ourcompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">444</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.ourcompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">444</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>445<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mymqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mymqtt1.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Our HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>446<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>ourmqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Our HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>ourmqtt1.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>445<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mymqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mymqtt2.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Our HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>446<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>ourmqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
  <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Our HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>ourmqtt2.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_option_2_b_2_2_servers_partially_behind_the_load_balancer">3.2.2.2. Option 2.B.2.2 – Servers Partially Behind the Load Balancer</h5>
<div class="paragraph">
<p>The two server sockets of MQTT.Cool, associated to two different keystores, can be bound to different (or the same) ports of two different IP addresses.
For example, the server socket on <code>10.0.0.1:444</code> (private IP address) will handle the <code>mqtt.mycompany.com</code> certificate, while the server socket on <code>200.0.0.1:443</code> (public IP address) will handle the <code>mqtt1.mycompany.com</code> certificate.
We emphasize this in our sample configuration by leveraging the possibility to specify different listening interfaces for the two listening ports.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">444</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>10.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>200.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt1.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>444<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>10.0.0.2<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>200.0.0.2<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt2.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: Only the "S" connection (which is always HTTPS-based) passes through the Balancer, while the "CR" connections (which can be upgraded to WSS) go straight to the MQTT.Cool servers.
Furthermore, this option works at Layer 4 (Layer 7 is impossible because SSL offloading is not being
used). So, WebSocket should always work with no issues.</p>
</div>
</div>
<div class="sect4">
<h5 id="_option_2_b_2_3_servers_behind_an_ssl_accelerator">3.2.2.3. Option 2.B.2.3 – Servers Behind an SSL Accelerator</h5>
<div class="paragraph">
<p>An external <strong>SSL Accelerator</strong> can be used to offload the SSL operations, though the limitations outlined at the beginning of <a href="#https_based_scenarios">Chapter 3, <em>HTTPS-Based Scenarios</em></a> should be taken into consideration.</p>
</div>
<div class="paragraph">
<p>The Load Balancer is extended with an SSL Acceleration module, that takes care of the encryption/decryption operations and uses HTTP to communicate with the final cluster nodes.
In order for this option to work, the SSL Accelerator must be able to manage different SSL certificates based on the IP address on which it is reached.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer + SSL Accel.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">81</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer + SSL Accel.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer + SSL Accel.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The two instances of MQTT.Cool do not need to have any public IP addresses and they are configured to listen only on an HTTP socket. The Load Balancer is exposed to the Clients through three different IP addresses.
The Balancer mounts three SSL certificates (associated to the three different hostnames) and chooses the certificate to use based on the target IP address of the Client
request.
So, all of the requests will reach the Load Balancer, which must adopt a routing algorithm based on the target IP address or –same result– on the hostname with which the request is received (the hostname is discovered after the request has been decrypted):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the target IP is 200.0.0.10, or the hostname is <code>mqtt</code>, the Balancer will use the balancing algorithm (e.g. round robin).</p>
</li>
<li>
<p>If the target IP is 200.0.0.1, or the hostname is <code>mqtt1</code>, it will send the request to Server 1.</p>
</li>
<li>
<p>If the target IP is 200.0.0.2, or the hostname is <code>mqtt2</code>, it will send the request to Server 2.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>81<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>81<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>
<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The separation between ports 80 and 81 is optional here; a single S+CR port can be used, although this would prevent the possibility to specify the port type and take advantage of the associated benefits.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: If the Balancer does not support WebSocket, configuring it at Layer 4 (TCP) can in some cases make WebSocket work, provided that the Balancer supports Layer-4 SSL offloading.</p>
</div>
</div>
<div class="sect4">
<h5 id="_option_2_b_2_4_servers_partially_behind_an_ssl_accelerator">3.2.2.4. Option 2.B.2.4 – Servers Partially Behind an SSL Accelerator</h5>
<div class="paragraph">
<p>The final nodes can be directly accessed through public IP addresses assigned to the MQTT.Cool servers boxes.</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Conn</th>
<th class="tableblock halign-center valign-top">Full Hostname</th>
<th class="tableblock halign-center valign-top">Reached Box</th>
<th class="tableblock halign-center valign-top">Public IP Address</th>
<th class="tableblock halign-center valign-top">Public TCP Port</th>
<th class="tableblock halign-center valign-top">Final Box</th>
<th class="tableblock halign-center valign-top">Final IP Address</th>
<th class="tableblock halign-center valign-top">Final Port</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Load Balancer + SSL Accel.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1 or MC server 2 (balancing)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10.0.0.1 or 10.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt1.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">CR</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">mqtt2.mycompany.com</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">MC server 2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">200.0.0.2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">443</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The two instances of MQTT.Cool listen to HTTP requests on a private-IP socket AND to HTTPS requests on a public-IP socket.
We emphasize this in our sample configuration by leveraging the possibility to specify different listening interfaces for the two listening ports.<br>
The Load Balancer mounts the SSL certificate associated to <code>mqtt.mycompany.com</code>.
The two MQTT.Cool servers mount the certificates relative to <code>mqtt1.mycompany.com</code> and <code>mqtt2.mycompany.com</code>.
The Balancer balances the incoming "S" connections, while the "CR" connections are directly sent to the final MQTT.Cool servers.</p>
</div>
<div class="paragraph">
<p>The <code>configuration.xml</code> file should contain the following elements:</p>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 1:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>10.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>200.0.0.1<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt1.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;control_link_address&gt;</span>mqtt1.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span>
<span class="tag">&lt;prestarted_max_queue&gt;</span>1000<span class="tag">&lt;/prestarted_max_queue&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On MQTT.Cool server 2:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP Server S</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CREATE_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>10.0.0.2<span class="tag">&lt;/listening_interface&gt;</span>
<span class="tag">&lt;/http_server&gt;</span>

<span class="tag">&lt;https_server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTPS Server CR</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;port&gt;</span>443<span class="tag">&lt;/port&gt;</span>
    <span class="tag">&lt;port_type&gt;</span>CONTROL_ONLY<span class="tag">&lt;/port_type&gt;</span>
    <span class="tag">&lt;listening_interface&gt;</span>200.0.0.2<span class="tag">&lt;/listening_interface&gt;</span>
    <span class="tag">&lt;keystore&gt;</span>
        <span class="tag">&lt;keystore_file&gt;</span>mqtt2.keystore<span class="tag">&lt;/keystore_file&gt;</span>
        <span class="tag">&lt;keystore_password&gt;</span>mypassword<span class="tag">&lt;/keystore_password&gt;</span>
    <span class="tag">&lt;/keystore&gt;</span>
<span class="tag">&lt;/https_server&gt;</span>

<span class="tag">&lt;control_link_address&gt;</span>mqtt2.mycompany.com<span class="tag">&lt;/control_link_address&gt;</span>
<span class="tag">&lt;prestarted_max_queue&gt;</span>1000<span class="tag">&lt;/prestarted_max_queue&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>&lt;prestarted_max_queue&gt;</code> setting is recommended here, in order to leverage the backpressure features provided by the Server.
In fact, in this particular configuration, the "CR" connections, being the only ones in TLS/SSL, may be slower than the "S" connections in the establishment phase.
This may pose problems,
whereas, in case of massive client arrival, this may originate a queue of session establishment requests waiting for the final rebind connection, with growing session establishment latencies.
The <code>&lt;prestarted_max_queue&gt;</code> setting puts a limit on this queue; the best value should be determined experimentally.</p>
</div>
<div class="paragraph">
<p><strong>WebSocket</strong>: This option is particularly useful If the Balancer does not support WebSocket.
Only the "S" connection (which is always HTTPS-based) passes through the Balancer, while the "CR" connections (which can be upgraded to WSS) go straight to the MQTT.Cool servers.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="stickiness_expiration">4. Stickiness Expiration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When LB stickiness (also known as affinity) is leveraged, it is possible that the Load Balancer sets a maximum duration for the association of a client to a Server instance, after which a new association is eventually established.
This may be even a necessary choice, in order to prevent that any imbalance situation occasionally arisen may persist (as further discussed in <a href="#force_rebalancing">Chapter 5, <em>How to Force a Rebalancing</em></a>).</p>
</div>
<div class="paragraph">
<p>In this scenario, it is possible that the Server instance associated to a client changes during the life of a client session.
This would compromise the correct behavior of the session, although the malfunctioning would not start immediately, but only upon the next [CR] connection that gets diverted to the other instance.
This, in turn, might not occur at the very next connection, depending on transport details, as, for instance, if <strong>WebSocket</strong> were in use, or if <strong>HTTP</strong> connection reuse were operated by the user-agent.</p>
</div>
<div class="paragraph">
<p>So, what happens is that a request suddenly reaches a wrong Server instance and this implies that the LB, from that moment, will stick the client to the new instance.
This case must be handled on the client side by opening a new session and migrating all the current activity to this session.<br>
The issue manifests itself in several different ways, depending on the specific client SDK in use and its version, and the handling also differs in the various cases.
Let&#8217;s see the possible combinations:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When a <em>rebind connection</em> reaches a wrong Server instance, it fails and the whole session is interrupted.</p>
<div class="paragraph">
<p>The clients SDKs will notify the session closure to the application with error code 21.
The application will then be responsible for recovering with a new session.
By restoring the connection with the Server, the subscriptions will be resubmitted automatically.</p>
</div>
</li>
<li>
<p>On the other hand, when a <em>control connection</em> reaches a wrong Server instance, it fails, although the session is not interrupted and the request may be resubmitted.</p>
<div class="paragraph">
<p>The clients SDKs will recognize the case and close the session, notifying the application with error code 21.
The application will then be responsible for recovering with a new session.
By restoring the connection with the Server, the subscriptions will be resubmitted automatically.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, note that when "Application Stickiness" (as defined previously) is leveraged, the associated Server instance is kept by the client library for the whole life of the session.
Hence, the stickiness is always guaranteed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="force_rebalancing">5. How to Force a Rebalancing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The stickiness requirement may lead to uneven balancing. A typical case is when an instance fails, or when an instance (or each instance in turn) is shut down for maintenance.<br>
When this happens, the Load Balancer will reset all associations towards this instance, and all clients, upon their first reconnection attempt, will be assigned to other instances, possibly causing overload issues.
When, later, the failed instance is restarted and added back to the pool, it becomes available to relieve the other instances from the extra load, but it cannot receive from the Load Balancer any connections related with the currently active clients, because they are constrained to the other instances.<br>
Even if, in a cloud scenario, a new instance is added to the pool immediately, the reconnection attempts, for balancing reasons, may not be all resubmitted to the new instance.</p>
</div>
<div class="paragraph">
<p>If a similar imbalance arises, it could be an acceptable trade-off to interrupt part of the client sessions served by an overloaded instance and change their associations so as to migrate these clients to an idle instance.</p>
</div>
<div class="paragraph">
<p>Further considerations depend on the way stickiness is managed.</p>
</div>
<div class="sect2">
<h3 id="_when_lb_stickiness_is_leveraged">5.1. When LB Stickiness Is Leveraged</h3>
<div class="paragraph">
<p>Even without explicitly interrupting some sessions, enforcing the Load Balancer to discontinue and change the current association for some clients may be enough to cause their sessions to migrate in reasonable time. As explained in <a href="#stickiness_expiration">Chapter 4, <em>Stickiness Expiration</em></a>, stickiness interruption must be managed by the application properly, to minimize the impact.</p>
</div>
<div class="paragraph">
<p>A simpler approach could be to configure the Load Balancer to set a maximum duration of the stickiness for any client, after which a new association would be established.
This can lead to a continuous and gradual adjustment of the balance.
On the other hand, this would cause occasional interruptions of the client sessions (which will be promptly recovered by the clients) also when no rebalancing needs are in place.
So, the choice of the duration to be set should be a trade-off.</p>
</div>
<div class="paragraph">
<p>Note that, as also pointed out in <a href="#stickiness_expiration">Chapter 4, <em>Stickiness Expiration</em></a>, there are cases in which the discontinuation of the stickiness may not be detected by the client for an arbitrarily long time.
To cope with these cases, a maximum duration limit for all sessions can be configured, in addition, on the Server, through the <code>&lt;max_session_duration_minutes&gt;</code> setting.
This ensures that the session is eventually interrupted with a specific error code, hence the client can recover and migrate in reasonable time.<br>
Again, the choice of the duration to be set should be a trade-off.</p>
</div>
<div class="paragraph">
<p>Recovery from this kind of interruption is managed by the SDK library.</p>
</div>
</div>
<div class="sect2">
<h3 id="_when_application_stickiness_is_leveraged">5.2. When Application Stickiness Is Leveraged</h3>
<div class="paragraph">
<p>When application stickiness is used, any time a new session is established, the associated Server instance is allowed to change.
As a consequence, a continuous and gradual adjustment of the balance is always in place.<br>
On the other hand, the associated Server instance is kept by the client library for the whole life of the session (i.e. no stickiness discontinuation is possible).
So, in scenarios in which client sessions last for very long time, issues with persisting imbalance are still possible.</p>
</div>
<div class="paragraph">
<p>As in the previous case, this can be coped with by configuring on the Server a maximum duration limit for all sessions, through the <code>&lt;max_session_duration_minutes&gt;</code> setting.
Needless to say, this would cause occasional interruption of the client sessions (which will be promptly recovered by the clients) also when no rebalancing needs are in place; hence the choice of the duration to be set should be a trade-off.</p>
</div>
</div>
<div class="sect2">
<h3 id="_notes_on_instance_replacement">5.3. Notes on Instance Replacement</h3>
<div class="paragraph">
<p>The approaches based on a maximum duration of balancing and/or of the Session itself may help in improving the balancing on the medium term, but prove insufficient to fully handle the case of instance failure or replacement.
In particular, they don’t help coping with the consequential massive reconnection requests, which stress the cluster.
Moreover, after a massive reconnection, all those sessions which started at the same time may also expire at the same time, unneededly reiterating the stress.</p>
</div>
<div class="paragraph">
<p>In case of a controlled instance replacement, a more sophisticated technique is available through the use of the JMX interface, provided that JMX management is available (since full JMX features is an optional feature, available depending on Edition and License Type).
So, instead of shutting down the instance and closing all sessions immediately, the sessions can be closed gradually before issuing the shutdown, by invoking the drainSessions operation on the Server Mbean.
The rate of session closes can also be configured.
The closures will be notified to the clients with code 48, which, as discussed above, instructs the client to reconnect.</p>
</div>
<div class="paragraph">
<p>If application stickiness is leveraged, during the draining phase, the instance can even be detached from the cluster, to keep it from new session creation requests, and still remain reachable for control requests for the trailing sessions.
Otherwise, the instance can be protected by also invoking the block operation on the Server Mbean.
New session creation requests will be refused and, again, the client will be instructed to retry, hopefully to be assigned to a different instance.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_accessing_server_instances_directly_and_the_monitoring_dashboard_case">6. Accessing Server Instances Directly and the Monitoring Dashboard Case</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases, mainly for testing purpose or for internal use, it may be needed that a browser-based client or an application client connects to a specific instance of the Server in the cluster, by addressing it through a direct hostname.<br>
This is in general possible, but in all scenarios in which the <code>&lt;control_link_address&gt;</code> setting is leveraged, that setting would still be used for [CR] connections and this could cause the application not to work, in case it were running inside the organization and using a private hostname, whereas the public hostname specified in <code>&lt;control_link_address&gt;</code> were not visible.</p>
</div>
<div class="paragraph">
<p>This limitation can be overcome by instructing the application to ignore the <code>&lt;control_link_address&gt;</code> setting.</p>
</div>
<div class="paragraph">
<p>This can be done trough a proper configuration setting that has been made available to application code.
Some code similar to the following should be added to initialization code before connecting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">lsClient.connectionOptions.setServerInstanceAddressIgnored(<span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously, a client that ignores the <code>&lt;control_link_address&gt;</code> may not work properly if it connects to the Server through the Load Balancer address.</p>
</div>
<div class="paragraph">
<p>A special case is a demo or test web front-end whose pages are directly hosted by MQTT.Cool through its basic Web Server support.
<br>
These front-ends, typically, don&#8217;t specify a Server hostname, so they access the Server through the same hostname by which their pages have been requested.<br>
These front-ends could be recalled either through the Load Balancer address or through a direct Server instance hostname. In the latter case, the above considerations hold.<br>
By the way, note that, in both cases, if the <code>&lt;control_link_address&gt;</code> setting is leveraged, these front-ends may still be subject to using different hostnames to access the Server.</p>
</div>
<div class="paragraph">
<p>The Monitoring Dashboard is also a browser-based application whose front-end is hosted (and directly supplied) by MQTT.Cool.<br>
Moreover, the Monitoring Dashboard is available for production use.<br>
As the purpose of the Monitoring Dashboard is that of inspecting single instances, it is configured to ignore any <code>&lt;control_link_address&gt;</code> setting; so it can be recalled through any public or private hostname of any Server instance, whereas recalling it through the Load Balancer address is not supported.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-09-03 14:03:02 UTC
</div>
</div>
</body>
</html>
